--Question 7--

--ensures that the output results will be displayed in the output console--
SET SERVEROUTPUT ON;

DECLARE
    --creates a cursor that selects bike information from the bike and donation tables--
    CURSOR cur_bikes IS
        SELECT b.BIKE_ID, b.BIKE_TYPE, b.MANUFACTURER, dn.BIKE_Value
        FROM BIKE b
        --joins the bike and donation tables using the BIKE_ID as the joining field--
        JOIN DONATION dn ON b.BIKE_ID = dn.BIKE_ID;

    --explanation for using %TYPE:
    --using %TYPE ensures that our variables will automatically match the data types of their corresponding
    --table columns, making the code more maintainable and resistant to database changes--

    --declares variables that store the values retrieved from cursor--
    v_bike_id       BIKE.BIKE_ID%TYPE;
    v_bike_type     BIKE.BIKE_TYPE%TYPE;
    v_manufacturer  BIKE.MANUFACTURER%TYPE;
    v_bike_value    DONATION.BIKE_Value%TYPE;
    v_status        VARCHAR2(10);
BEGIN
    --loops through each record in the cursor to process bikes one at a time--
    FOR rec IN cur_bikes LOOP
        --assigns the values from the cursor to local variables for processing--
        v_bike_id := rec.BIKE_ID;
        v_bike_type := rec.BIKE_TYPE;
        v_manufacturer := rec.MANUFACTURER;
        v_bike_value := rec.BIKE_Value;

        --determines the status based on the bike value using an IF statement--
        --assigns three stars for values over R3000--
        --assigns two stars for values over R1500--
        --assigns one star for all other values--
        IF v_bike_value > 3000 THEN
            v_status := '***';
        ELSIF v_bike_value > 1500 THEN
            v_status := '**';
        ELSE
            v_status := '*';
        END IF;

        --displays all the bike information and status in a formatted output using string concatenation--
        DBMS_OUTPUT.PUT_LINE(
            'Bike ID: ' || v_bike_id ||
            ' | Type: ' || v_bike_type ||
            ' | Manufacturer: ' || v_manufacturer ||
            ' | Value: R ' || TO_CHAR(v_bike_value, '9999.99') ||
            ' | Status: ' || v_status
        );
    END LOOP;
END;

--------------------------------------------------EOF--------------------------------------------------